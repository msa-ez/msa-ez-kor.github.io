{"hash":"d0f9acdb392ff7740d2cd28b1dd4865c031953e3","data":{"markdownPage":{"id":"28b3f9810c95d264729fd1b45ad2504e","title":"테스트 자동화","description":"","path":"/custom-template/unit-test/","timeToRead":2,"content":"<h1 id=\"테스트-자동화\"><a href=\"#%ED%85%8C%EC%8A%A4%ED%8A%B8-%EC%9E%90%EB%8F%99%ED%99%94\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>테스트 자동화</h1>\n<h2 id=\"unit-test-생성-토핑\"><a href=\"#unit-test-%EC%83%9D%EC%84%B1-%ED%86%A0%ED%95%91\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Unit Test 생성 토핑</h2>\n<!-- <div style = \"height:400px; object-fit: cover;\">\n<iframe style = \"width:100%; height:100%;\" src=\"https://www.youtube.com/embed/WF1fWdkFun0\" title=\"YouTube video player\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen></iframe>\n</div> -->\n<div style=\"position: relative; padding-bottom: 56.25%; padding-top: 0px; height: 0; overflow: hidden;\">\n\t<iframe style=\"position: absolute; top: 0; left: 0; width: 100%; height: 100%;\" \n        src=\"https://www.youtube.com/embed/WF1fWdkFun0\" \n        frameborder=\"0\" crolling=\"no\" frameborder=\"none\" allowfullscreen=\"\">\n    </iframe>\n</div>\n<br>\n<p>단위 테스트를 하기 위한 코드를 자동으로 생성하는 토핑이 추가되었습니다.</p>\n<p><img src=\"https://github.com/msa-ez/msa-ez.github.io/assets/113568664/3569acfc-36bd-464e-8944-1bf2a0e589e7\" alt=\"스크린샷 2023-11-06 오후 4 39 33\"></p>\n<h3 id=\"세부-스펙\"><a href=\"#%EC%84%B8%EB%B6%80-%EC%8A%A4%ED%8E%99\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>세부 스펙</h3>\n<p>마켓플레이스에서 Unit Test 토핑을 선택할 수 있고, 이를 적용하면 마이크로서비스 소스 내에 test 라는 폴더가 생성됩니다.</p>\n<p><img src=\"https://github.com/msa-ez/msa-ez.github.io/assets/113568664/ecb2ef37-e8cc-42cc-84f6-01e54179888d\" alt=\"스크린샷 2023-11-06 오후 4 52 24\"></p>\n<p>test 폴더 내에는 도메인 이벤트에 대한 policy 명으로 테스트 파일이 생성됩니다.</p>\n<p><img src=\"https://github.com/msa-ez/msa-ez.github.io/assets/113568664/7cd50ed9-431d-4125-9800-d8f6a06b7e91\" alt=\"스크린샷 2023-11-06 오후 4 53 42\"></p>\n<p>코드를 살펴보면 given에서 엔티티에 대한 재고량과 상품 아이디 등의 데이터를 보여주고, when에서 들어온 주문 정보를 보여주고, 이벤트가 퍼블리쉬되면 then에서 받은 메시지에 따른 결과가 표시됩니다.</p>\n<p>로직이 작동하면 폴리시핸들러를 통해 이벤트가 수신되고 해당 이벤트를 받아서 도메인 로직이 작동하는데, 로직이 실제 데이터 업데이트를 하기 위해 이벤트에 대한 처리를 진행하고 그 결과가 잘 만들어지면 테스트가 정상적으로 완료됩니다.</p>\n<p>이렇게 단위테스트를 활용하면 내부적으로 스프링 프레임워크에 의해 이벤트가 퍼블리쉬되고 메시지컬렉터를 통해 결과를 받을 수 있어, 실제 카프카 서버 없이 로컬에서 자체적으로 테스트가 가능합니다.</p>\n<h3 id=\"실제-적용\"><a href=\"#%EC%8B%A4%EC%A0%9C-%EC%A0%81%EC%9A%A9\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>실제 적용</h3>\n<p><img src=\"https://github.com/msa-ez/msa-ez.github.io/assets/113568664/0877f676-4085-4ffd-9832-ebb06dc56a5c\" alt=\"스크린샷 2023-11-06 오후 4 58 00\"></p>\n<p>깃파드에서 실제 운용을 해보면 앞서 code preview에서 본 것과 같이 인벤토리 마이크로서비스 폴더 내에 테스트 코드가 들어와있고,</p>\n<p><img src=\"https://github.com/msa-ez/msa-ez.github.io/assets/113568664/bd543df7-9616-4eb3-b96e-734acd80c923\" alt=\"스크린샷 2023-11-06 오후 4 59 19\"></p>\n<p>단위 테스트를 진행하고자 하는 폴더에서 터미널을 열어 mvn test 명령어를 입력하면 비즈니스 로직에 대한 검증이 진행됩니다.</p>\n<h2 id=\"open-api-30-기반-목-서버-생성-토핑\"><a href=\"#open-api-30-%EA%B8%B0%EB%B0%98-%EB%AA%A9-%EC%84%9C%EB%B2%84-%EC%83%9D%EC%84%B1-%ED%86%A0%ED%95%91\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Open API 3.0 기반 목 서버 생성 토핑</h2>\n<div style=\"position: relative; padding-bottom: 56.25%; padding-top: 0px; height: 0; overflow: hidden;\">\n\t<iframe style=\"position: absolute; top: 0; left: 0; width: 100%; height: 100%;\" \n        src=\"https://www.youtube.com/embed/BlqwuMqI3J8\" \n        frameborder=\"0\" crolling=\"no\" frameborder=\"none\" allowfullscreen=\"\">\n    </iframe>\n</div>\n<br>\n<p>마이크로서비스 간의 연동에 있어서 디펜던시 마이크로서비스에 대한 실제 서비스가 올라가있지 않더라도 병렬 개발이 가능하도록 하기 위해 해당 서버의 mock 서버를 만들어 테스트할 수 있는 개발 디펜던시를 자동으로 생성해주고 Open API 3.0 버전을 통해 example까지 만들어주는 토핑이 추가되었습니다.</p>\n<h3 id=\"세부-스펙-1\"><a href=\"#%EC%84%B8%EB%B6%80-%EC%8A%A4%ED%8E%99-1\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>세부 스펙</h3>\n<p><img src=\"https://github.com/msa-ez/msaschool.github.io/assets/113568664/ffaa62b4-e480-4a18-8e2d-dd228744685c\" alt=\"image\"></p>\n<p>마켓플레이스로 이동해서 토핑 쪽에 있는 Local microservice development dependencies의 세부 역할을 살펴보면</p>\n<ol>\n<li>Open API 3.0 api를 자동으로 모델에서 생성한다.</li>\n<li>yml 형태의 api를 생성하고 오픈소스인 마이크록스를 통해 목 서버를 생성한다.</li>\n<li>api 다큐멘테이션을 생성한다.</li>\n<li>이와 관련해서 비동기 연동을 위한 카프카 서버를 함께 실행시켜주는 역할을 한다.</li>\n</ol>\n<p>Open API 3.0의 장점은 example 스펙이 추가되어 여러가지 입력에 대한 기댓값을 작성할 수 있게 되고, 그것을 바탕으로 이벤트스토밍 모델에서 example을 함께 작성이 가능하다는 것입니다.</p>\n<p>이 토핑을 적용하면 각 마이크로서비스에 대한 infra 폴더가 생성되어 그 안에 openapi.yaml 파일이 생성되고 docker-compose를 실행시킴으로써 디펜던시들이 목 서버와 함께 자동으로 생성 및 실행됩니다.</p>\n<h3 id=\"실제-적용-1\"><a href=\"#%EC%8B%A4%EC%A0%9C-%EC%A0%81%EC%9A%A9-1\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>실제 적용</h3>\n<p><img src=\"https://github.com/msa-ez/msaschool.github.io/assets/113568664/c8ab2295-4311-4b70-954c-4a63781febd4\" alt=\"스크린샷 2023-10-31 오후 4 36 54\"></p>\n<p>실제로 마켓플레이스에서 가져온 local-dep 토핑을 코드에 적용해보면 order 마이크로서비스 내에 infra 폴더가 생성되고, 그 내부 api 폴더에 openapi.yaml 파일이 생성된 것을 확인할 수 있습니다. 여기에 작성된 스펙을 통해 mock 서버를 직접 만들어나갈 수 있습니다.</p>\n<p><img src=\"https://github.com/msa-ez/msaschool.github.io/assets/113568664/c7ee0127-a6d9-4591-9247-1e798ee40278\" alt=\"스크린샷 2023-10-31 오후 4 39 28\"></p>\n<p>해당 스펙에 명시된 example을 통해 각 제품에 대한 주문 액션이 취해지면 재고량이 줄어드는 리턴값이 주어집니다.</p>\n<p><img src=\"https://github.com/msa-ez/msaschool.github.io/assets/113568664/eb61ae67-423a-44b5-a643-5fdae703c57b\" alt=\"스크린샷 2023-10-31 오후 4 58 09\"></p>\n<p>커맨드를 설정할 때 예시 데이터를 입력할 수 있는 ui가 추가되어 위 ui에서 example의 결과값을 직접 입력해 편집이 가능합니다. </p>\n<p>여기서 Given, When, Then은 각각 Aggregate의 기존 상태, 호출된 api, 그로 인해 발행된 도메인 이벤트에서 담고 있는 데이터를 의미합니다. 테스트를 위해 입력한 데이터 값을 그대로 받아서 open api 스펙에서 생성이 가능합니다.</p>\n","sidebar":"started","next":"","prev":"","headings":[{"depth":1,"value":"테스트 자동화","anchor":"#테스트-자동화"},{"depth":2,"value":"Unit Test 생성 토핑","anchor":"#unit-test-생성-토핑"},{"depth":3,"value":"세부 스펙","anchor":"#세부-스펙"},{"depth":3,"value":"실제 적용","anchor":"#실제-적용"},{"depth":2,"value":"Open API 3.0 기반 목 서버 생성 토핑","anchor":"#open-api-30-기반-목-서버-생성-토핑"},{"depth":3,"value":"세부 스펙","anchor":"#세부-스펙-1"},{"depth":3,"value":"실제 적용","anchor":"#실제-적용-1"}]},"allMarkdownPage":{"edges":[{"node":{"path":"/toppings/test-messaging/","title":"Contract Test (비동기호출)"}},{"node":{"path":"/toppings/test-unit/","title":"Unit-Test"}},{"node":{"path":"/toppings/test-microcks/","title":"API Mock Server"}},{"node":{"path":"/toppings/test-contract/","title":"Contract Test (동기호출)"}},{"node":{"path":"/toppings/k8s-kubernetes/","title":"Kubernetes"}},{"node":{"path":"/toppings/cicd-argo/","title":"Argo"}},{"node":{"path":"/tool/si-gpt/","title":""}},{"node":{"path":"/toppings/cicd-git-action/","title":"Github Action"}},{"node":{"path":"/tool/setup-on-prem/","title":"Running on Docker Compose (with Github)"}},{"node":{"path":"/tool/wireframe-generate/","title":"모델 기반 바이브코딩을 통한 프론트엔드 구현"}},{"node":{"path":"/tool/pbc-marketplace/","title":"컴포저블 엔터프라이즈 구현을 위한 PBCs(Packaged Business Capabilities)"}},{"node":{"path":"/tool/plsql-2-java/","title":"Legacy Modernizer"}},{"node":{"path":"/tool/on-prem-inst/","title":"on-prem 설치 설명서"}},{"node":{"path":"/tool/on-prem-inst-gitea/","title":"on-prem 설치 설명서"}},{"node":{"path":"/tool/model-driven/","title":"코드 생성"}},{"node":{"path":"/tool/marketplace/","title":"마켓플레이스"}},{"node":{"path":"/tool/k8s-modeling/","title":"K8s 배포 모델링"}},{"node":{"path":"/tool/infrastructure-modeling/","title":"인프라 모델링 (쿠버네티스)"}},{"node":{"path":"/tool/google-drive-examples/","title":"Quick Start"}},{"node":{"path":"/tool/development-practice/","title":"강의 개발 및 실습 환경"}},{"node":{"path":"/tool/event-storming-tool/","title":"이벤트스토밍"}},{"node":{"path":"/tool/event-monitoring/","title":"이벤트 모니터링"}},{"node":{"path":"/tool/deepseek-ai/","title":""}},{"node":{"path":"/tool/ddl-to-eventstorming2/","title":"DDL To EventStorming"}},{"node":{"path":"/tool/ddl-to-eventstorming/","title":"DDL To EventStorming"}},{"node":{"path":"/tool/cloud-ide-tool/","title":"클라우드 IDE"}},{"node":{"path":"/tool/chat-gpt/","title":"AI 기반 모델 생성"}},{"node":{"path":"/tool/bc-domain-gen/","title":"자연어 기반 Bounded Context & 도메인 설계 AI"}},{"node":{"path":"/tool/attending-lectures/","title":"Attending lectures"}},{"node":{"path":"/templates-language/python-template/","title":"Python Template "}},{"node":{"path":"/tool/aggregate-design/","title":"애그리거트(Aggregate) 설계"}},{"node":{"path":"/templates-language/springboot-java-template/","title":"Spring Boot/Java Template(준비중)"}},{"node":{"path":"/templates-language/go-template/","title":"Go Template"}},{"node":{"path":"/started/vibe-coding/","title":"Vibe Coding"}},{"node":{"path":"/started/","title":"소개"}},{"node":{"path":"/operation/ops-deploy-diagramming-basic-objects/","title":"12st Mall Basic Deploy"}},{"node":{"path":"/started/key-features/","title":"주요 기능"}},{"node":{"path":"/started/event-storming-learning/","title":"이벤트스토밍 학습"}},{"node":{"path":"/started/domain-driven/","title":"도메인 주도 설계 학습"}},{"node":{"path":"/operation/ops-deploy-diagramming-advanced-pvc/","title":"Persistent Volume"}},{"node":{"path":"/operation/ops-deploy-diagramming-advanced-istio/","title":"Istio Mesh"}},{"node":{"path":"/operation/ops-deploy-diagramming-advanced-ingress/","title":"Ingress 배포모델 설계"}},{"node":{"path":"/operation/ops-deploy-diagramming-advanced-hpa/","title":"자동확장(HPA) 배포"}},{"node":{"path":"/info/pricing/","title":"가격 정책"}},{"node":{"path":"/info/consulting/","title":"컨설팅"}},{"node":{"path":"/info/partnership/","title":"파트너 프로그램"}},{"node":{"path":"/example-scenario/online-lecture/","title":"인터넷 강의수강 시스템"}},{"node":{"path":"/info/company/","title":"기업 사례"}},{"node":{"path":"/example-scenario/animal-hospital/","title":"동물병원 진료시스템"}},{"node":{"path":"/example-scenario/library-system/","title":"도서관 시스템"}},{"node":{"path":"/example-scenario/food-delivery/","title":"음식배달"}},{"node":{"path":"/example-scenario/accommodation-reservation/","title":"숙소예약"}},{"node":{"path":"/development/understanding-jpa-based-single-microservice/","title":"마이크로서비스 구현 및 동작원리 이해"}},{"node":{"path":"/development/token-based-auth/","title":"JWT Token 기반 인증 인가"}},{"node":{"path":"/development/pubsub-idempotency/","title":"Pub/Sub 방식의 연동 - Choreography with Idempotency"}},{"node":{"path":"/development/pubsub-deadline/","title":"Pub/Sub 방식의 연동 - Choreography with Deadline added"}},{"node":{"path":"/development/orchestration-saga/","title":"Orchestration Saga with Axon Framework"}},{"node":{"path":"/development/pub-sub/","title":"Pub/Sub 방식의 연동 "}},{"node":{"path":"/development/ops-docker/","title":"Application Packaging with Container (Docker)"}},{"node":{"path":"/development/monolith-2-misvc/","title":"Req/Res 방식의 MSA 연동 "}},{"node":{"path":"/development/oauth2with-keycloak/","title":"JWT Token 기반 인증 인가"}},{"node":{"path":"/development/kafka-scaling/","title":"Kafka Scaling "}},{"node":{"path":"/development/kafka-scaling-concurrenty-handling/","title":"Kafka scaling & Concurrenty handling"}},{"node":{"path":"/development/kafka-connect/","title":"CDC(Change Data Capture) with Kafka"}},{"node":{"path":"/development/kafka-retry-dlq/","title":"Kafka Retry & Dead Letter Queue "}},{"node":{"path":"/development/gateway/","title":"API Gateway"}},{"node":{"path":"/development/kafka-basic/","title":"Kafka 기본 명령어 "}},{"node":{"path":"/development/dp-cqrs/","title":"Data Projection with CQRS"}},{"node":{"path":"/development/dp-graphql/","title":"Data Projection with GraphQL"}},{"node":{"path":"/development/dp-frontend/","title":"Data Projection with Frontend and HATEOAS"}},{"node":{"path":"/development/contract-test/","title":"Contract Test (Consumer Driven Test)"}},{"node":{"path":"/development/choreography-saga/","title":"Choreography Saga"}},{"node":{"path":"/development/conteact-messaging/","title":"Conteact Test by Message-based CDC"}},{"node":{"path":"/development/compensation-correlation/","title":"Pub/Sub 방식의 연동 - Compensation 과 Correlation"}},{"node":{"path":"/development/cna-start/","title":"단위 마이크로 서비스의 실행 "}},{"node":{"path":"/development/circuit-breaker/","title":"Req/Res 방식에서 장애전파 차단 - 서킷브레이커 "}},{"node":{"path":"/custom-template/unit-test/","title":"테스트 자동화"}},{"node":{"path":"/custom-template/tutorial/","title":"커스텀 템플릿 개념"}},{"node":{"path":"/custom-template/understanding-template-structure/","title":"템플릿 구조의 이해"}},{"node":{"path":"/custom-template/template-structure/","title":"템플릿 파일 구조"}},{"node":{"path":"/custom-template/template-syntax/","title":"Template 문법의 이해"}},{"node":{"path":"/custom-template/template-editor/","title":"Template Editor"}},{"node":{"path":"/custom-template/template-editor-custom-template/","title":"커스텀 템플릿 생성 방법"}},{"node":{"path":"/custom-template/mock-server/","title":"Open API 3.0 기반 목 서버 생성 토핑(New)"}},{"node":{"path":"/custom-template/loop-conditional-statement/","title":"반복문 & 조건문"}},{"node":{"path":"/custom-template/designing-template-helper/","title":"Built-in Helper functions"}},{"node":{"path":"/custom-template/global-helper/","title":"Global Helper"}},{"node":{"path":"/custom-template/helper/","title":"Helper"}},{"node":{"path":"/custom-template/custom-template/","title":"Eventstorming Template Objects"}},{"node":{"path":"/custom-template/creating-custom-template-1/","title":"커스텀 템플릿 생성"}},{"node":{"path":"/contact/question/","title":"CONTACT"}},{"node":{"path":"/business/eventstorming-fooddelivery/","title":"[이벤트스토밍] - DDD Food Delivery 예제"}},{"node":{"path":"/business/","title":"이벤트스토밍"}},{"node":{"path":"/business/ddd-google-drive/","title":"[이벤트스토밍] - 구글 드라이브 예제"}}]}},"context":{}}